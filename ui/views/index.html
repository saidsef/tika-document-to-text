<!doctype html>
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="x-dns-prefetch-control" content="on" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>Object to Text</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous" />
</head>
<body class="container-fluid" itemscope itemtype="https://schema.org/WebPage">
  <div class="container-fluid">
    <form action="" method="post" enctype="multipart/form-data">
      <div class="modal-body">
        <div class="form-group">
          <label for="url">Enter URL: </label>
          <input id="url" type="text" class="form-control" name="url" x-webkit-speech="x-webkit-speech" value="${(typeof d.url === 'undefined') ? '' : d.url}" placerholder="Object URL" />
        </div>
        <div class="custom-file">
          <label class="custom-file-label" for="doc"><small>(or)</small> Upload File:</label>
          <input type="file" class="custom-file-input" id="doc" name="doc" />
        </div>
      </div>
      <div class="modal-body">
        <textarea x-webkit-speech="x-webkit-speech" id="text" name="text" class="form-control" aria-label="With textarea" rows="20">${(typeof d.text === 'undefined') ? '' : d.text }</textarea>
      </div>
      <div class="modal-footer">
        <select class="custom-select mr-sm-2" id="voiceselection" data-live-search="true"></select>
        <button type="submit" class="btn btn-primary">Submit</button>
        <button type="button" class="btn btn-dark" id="read">Read</button>
        <button type="button" class="btn btn-secondary" onclick="$('#resume').toggle();" id="pause">Pause</button>
        <button type="button" class="btn btn-success" onclick="$('#resume').toggle();" id="resume" style="display: none;">Resume</button>
      </div>
    </form>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
  <script type="text/javascript" nonce="${d.nonce}">
    document.addEventListener('DOMContentLoaded', () => {
      function doVoice() {
        let voicelist = $('#voiceselection');
        if (voicelist.find('option').length == 0) {
          speechSynthesis.getVoices().forEach((voice, index) => {
          let option = $('<option>').val(index).html(voice.name + ' (' + voice.lang + ' )' + (voice.default ? ' (default)' : ''));
          voicelist.append(option);
          });
          voicelist.find(":selected").val();
        }
      }
      if ('speechSynthesis' in window) {
        let msg = new SpeechSynthesisUtterance();
        speechSynthesis.cancel();
        if ('onvoiceschanged' in speechSynthesis) {
          speechSynthesis.addEventListener('voiceschanged', doVoice);
        } else {
          doVoice();
        }
        $('#read').click(() => {
          let text = document.getSelection().toString().length ? document.getSelection().toString().toString() : $('#text');
          speechSynthesis.cancel();
          msg.voice   = speechSynthesis.getVoices()[$('#voiceselection').val()];
          msg.rate    = 1;
          msg.pitch   = 1;
          msg.text    = typeof(text) === 'object' ? text.val() : text;
          msg.onpause = (e) => {
            console.log('Speech paused after ' + e.elapsedTime + ' milliseconds.');
          }
          msg.onresume = (e) => {
            console.log('Speech resumed after ' + e.elapsedTime + ' milliseconds.');
          }
          msg.onend = (e) => {
            console.log('Speech finished after ' + e.elapsedTime + ' milliseconds.');
          };
          msg.onboundary = (e) => {
            if (typeof(text) === 'object')
              text.focus().prop({'selectionStart': e.charIndex, 'selectionEnd': e.charIndex+e.charLength, 'color': 'ff00cc', 'selectionDirection': 'forward'});
          }
          speechSynthesis.speak(msg);
        });
        $('#pause').click(() => {
          msg.paused = true;
          speechSynthesis.pause();
        });
        $('#resume').click(() => {
          speechSynthesis.resume();
        });
      }
    }, false);
    document.addEventListener('unload', () => {
      window.speechSynthesis.cancel();
    }, false);
  </script>
  <footer class="card-footer">
    <p class="text-center text-muted small">&copy; Copyright <script type="text/javascript">document.write(new Date().getFullYear())</script> saidsef. All Rights Reserved</p>
  </footer>
</body>
</html>
